{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useAuth}from'../contexts/AuthContext';import{Moon,Sun,Compass,MessageCircle,User,LogOut}from'lucide-react';import{collection,query,where,onSnapshot}from'firebase/firestore';import{db}from'../firebase/config';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Navigation=_ref=>{let{onNavigate,onToggleTheme,isDarkMode}=_ref;const{currentUser,logout}=useAuth();const[isMenuOpen,setIsMenuOpen]=useState(false);const[totalUnreadMessages,setTotalUnreadMessages]=useState(0);useEffect(()=>{if(!currentUser)return;// Listen for unread messages\nconst messagesRef=collection(db,'messages');const messagesQuery=query(messagesRef,where('participants','array-contains',currentUser.id));const unsubscribe=onSnapshot(messagesQuery,snapshot=>{const allMessages=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));// Count unread messages from other users\nconst unreadCount=allMessages.filter(msg=>{var _msg$readBy;return msg.senderId!==currentUser.id&&// Only count messages from others\n!((_msg$readBy=msg.readBy)!==null&&_msg$readBy!==void 0&&_msg$readBy.includes(currentUser.id));}// Only count unread messages\n).length;setTotalUnreadMessages(unreadCount);},error=>{console.error('Error listening to messages for notification count:',error);});return()=>unsubscribe();},[currentUser]);const handleLogout=async()=>{try{await logout();onNavigate('home');}catch(error){console.error('Failed to log out:',error);}};return/*#__PURE__*/_jsx(\"nav\",{className:\"gradient-bg shadow-xl\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between h-16\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center\",children:/*#__PURE__*/_jsxs(\"h1\",{className:\"text-2xl font-bold text-white cursor-pointer hover-scale\",onClick:()=>onNavigate('home'),children:[\"\\uD83C\\uDFA8 KalaKriti \",/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-normal opacity-75\",children:\"v5.0\"})]})}),currentUser&&/*#__PURE__*/_jsxs(\"div\",{className:\"hidden md:flex items-center space-x-6\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onNavigate('explore'),className:\"text-white hover:text-gray-200 px-3 py-2 rounded-md transition-colors flex items-center\",children:[/*#__PURE__*/_jsx(Compass,{className:\"w-4 h-4 mr-2\"}),\"Explore\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onNavigate('messages'),className:\"text-white hover:text-gray-200 px-3 py-2 rounded-md relative transition-colors flex items-center\",children:[/*#__PURE__*/_jsx(MessageCircle,{className:\"w-4 h-4 mr-2\"}),\"Messages\",totalUnreadMessages>0&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\",children:totalUnreadMessages>99?'99+':totalUnreadMessages})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onNavigate('profile'),className:\"text-white hover:text-gray-200 px-3 py-2 rounded-md transition-colors flex items-center\",children:[/*#__PURE__*/_jsx(User,{className:\"w-4 h-4 mr-2\"}),\"Profile\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[currentUser?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[currentUser.photo?/*#__PURE__*/_jsx(\"img\",{src:currentUser.photo,alt:currentUser.name,className:\"profile-photo\",onError:e=>{e.target.style.display='none';e.target.nextSibling.style.display='flex';}}):/*#__PURE__*/_jsx(\"div\",{className:\"profile-photo bg-purple-100 flex items-center justify-center\",children:/*#__PURE__*/_jsx(User,{className:\"text-purple-600\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"profile-photo bg-purple-100 flex items-center justify-center\",style:{display:'none'},children:/*#__PURE__*/_jsx(User,{className:\"text-purple-600\"})})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-white font-medium\",children:[\"Welcome, \",currentUser.name,\"!\"]})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleLogout,className:\"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center\",children:[/*#__PURE__*/_jsx(LogOut,{className:\"w-4 h-4 mr-2\"}),\"Logout\"]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>onNavigate('login'),className:\"text-white hover:text-gray-200 px-3 py-2 rounded-md transition-colors\",children:\"Login\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>onNavigate('register'),className:\"bg-white text-purple-600 hover:bg-gray-100 px-4 py-2 rounded-lg transition-colors\",children:\"Sign Up\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onToggleTheme,className:\"text-white hover:text-gray-200 px-3 py-2 rounded-md transition-colors\",children:isDarkMode?/*#__PURE__*/_jsx(Sun,{className:\"w-4 h-4\"}):/*#__PURE__*/_jsx(Moon,{className:\"w-4 h-4\"})})]})]})})});};export default Navigation;","map":{"version":3,"names":["React","useState","useEffect","useAuth","Moon","Sun","Compass","MessageCircle","User","LogOut","collection","query","where","onSnapshot","db","jsx","_jsx","jsxs","_jsxs","Navigation","_ref","onNavigate","onToggleTheme","isDarkMode","currentUser","logout","isMenuOpen","setIsMenuOpen","totalUnreadMessages","setTotalUnreadMessages","messagesRef","messagesQuery","id","unsubscribe","snapshot","allMessages","docs","map","doc","data","unreadCount","filter","msg","_msg$readBy","senderId","readBy","includes","length","error","console","handleLogout","className","children","onClick","photo","src","alt","name","onError","e","target","style","display","nextSibling"],"sources":["D:/c project/kalakriti2.0/src/components/Navigation.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { Moon, Sun, Compass, MessageCircle, User, LogOut } from 'lucide-react';\r\nimport { collection, query, where, onSnapshot } from 'firebase/firestore';\r\nimport { db } from '../firebase/config';\r\n\r\nconst Navigation = ({ onNavigate, onToggleTheme, isDarkMode }) => {\r\n  const { currentUser, logout } = useAuth();\r\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\r\n  const [totalUnreadMessages, setTotalUnreadMessages] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (!currentUser) return;\r\n\r\n    // Listen for unread messages\r\n    const messagesRef = collection(db, 'messages');\r\n    const messagesQuery = query(\r\n      messagesRef,\r\n      where('participants', 'array-contains', currentUser.id)\r\n    );\r\n\r\n    const unsubscribe = onSnapshot(messagesQuery, (snapshot) => {\r\n      const allMessages = snapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      }));\r\n\r\n      // Count unread messages from other users\r\n      const unreadCount = allMessages.filter(msg => \r\n        msg.senderId !== currentUser.id && // Only count messages from others\r\n        !msg.readBy?.includes(currentUser.id) // Only count unread messages\r\n      ).length;\r\n\r\n      setTotalUnreadMessages(unreadCount);\r\n    }, (error) => {\r\n      console.error('Error listening to messages for notification count:', error);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [currentUser]);\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      await logout();\r\n      onNavigate('home');\r\n    } catch (error) {\r\n      console.error('Failed to log out:', error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <nav className=\"gradient-bg shadow-xl\">\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n        <div className=\"flex justify-between h-16\">\r\n          <div className=\"flex items-center\">\r\n            <h1 \r\n              className=\"text-2xl font-bold text-white cursor-pointer hover-scale\" \r\n              onClick={() => onNavigate('home')}\r\n            >\r\n              ðŸŽ¨ KalaKriti <span className=\"text-sm font-normal opacity-75\">v5.0</span>\r\n            </h1>\r\n          </div>\r\n          \r\n          {currentUser && (\r\n            <div className=\"hidden md:flex items-center space-x-6\">\r\n              <button \r\n                onClick={() => onNavigate('explore')} \r\n                className=\"text-white hover:text-gray-200 px-3 py-2 rounded-md transition-colors flex items-center\"\r\n              >\r\n                <Compass className=\"w-4 h-4 mr-2\" />\r\n                Explore\r\n              </button>\r\n              \r\n              <button \r\n                onClick={() => onNavigate('messages')} \r\n                className=\"text-white hover:text-gray-200 px-3 py-2 rounded-md relative transition-colors flex items-center\"\r\n              >\r\n                <MessageCircle className=\"w-4 h-4 mr-2\" />\r\n                Messages\r\n                {totalUnreadMessages > 0 && (\r\n                  <div className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\">\r\n                    {totalUnreadMessages > 99 ? '99+' : totalUnreadMessages}\r\n                  </div>\r\n                )}\r\n              </button>\r\n              \r\n              <button \r\n                onClick={() => onNavigate('profile')} \r\n                className=\"text-white hover:text-gray-200 px-3 py-2 rounded-md transition-colors flex items-center\"\r\n              >\r\n                <User className=\"w-4 h-4 mr-2\" />\r\n                Profile\r\n              </button>\r\n            </div>\r\n          )}\r\n          \r\n          <div className=\"flex items-center space-x-4\">\r\n            {currentUser ? (\r\n              <div className=\"flex items-center space-x-4\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"relative\">\r\n                    {currentUser.photo ? (\r\n                      <img \r\n                        src={currentUser.photo} \r\n                        alt={currentUser.name} \r\n                        className=\"profile-photo\"\r\n                        onError={(e) => {\r\n                          e.target.style.display = 'none';\r\n                          e.target.nextSibling.style.display = 'flex';\r\n                        }}\r\n                      />\r\n                    ) : (\r\n                      <div className=\"profile-photo bg-purple-100 flex items-center justify-center\">\r\n                        <User className=\"text-purple-600\" />\r\n                      </div>\r\n                    )}\r\n                    <div className=\"profile-photo bg-purple-100 flex items-center justify-center\" style={{ display: 'none' }}>\r\n                      <User className=\"text-purple-600\" />\r\n                    </div>\r\n                  </div>\r\n                  <span className=\"text-white font-medium\">Welcome, {currentUser.name}!</span>\r\n                </div>\r\n                <button \r\n                  onClick={handleLogout} \r\n                  className=\"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center\"\r\n                >\r\n                  <LogOut className=\"w-4 h-4 mr-2\" />\r\n                  Logout\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex items-center space-x-4\">\r\n                <button \r\n                  onClick={() => onNavigate('login')} \r\n                  className=\"text-white hover:text-gray-200 px-3 py-2 rounded-md transition-colors\"\r\n                >\r\n                  Login\r\n                </button>\r\n                <button \r\n                  onClick={() => onNavigate('register')} \r\n                  className=\"bg-white text-purple-600 hover:bg-gray-100 px-4 py-2 rounded-lg transition-colors\"\r\n                >\r\n                  Sign Up\r\n                </button>\r\n              </div>\r\n            )}\r\n            \r\n            <button \r\n              onClick={onToggleTheme} \r\n              className=\"text-white hover:text-gray-200 px-3 py-2 rounded-md transition-colors\"\r\n            >\r\n              {isDarkMode ? <Sun className=\"w-4 h-4\" /> : <Moon className=\"w-4 h-4\" />}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </nav>\r\n  );\r\n};\r\n\r\nexport default Navigation; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}