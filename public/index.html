<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KalaKriti v5 - Artist Collaboration Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .talent-badge { background: linear-gradient(45deg, #ff6b6b, #feca57); }
        .collab-badge { background: linear-gradient(45deg, #48cae4, #023e8a); }
        .hero-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .pulse-animation { animation: pulse 2s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .dark {
            background-color: #0f0f0f;
            color: #e5e5e5;
        }
        .dark .bg-gray-50 { background-color: #1a1a1a; }
        .dark .bg-white { background-color: #2d2d2d; }
        .dark .text-gray-800 { color: #e5e5e5; }
        .dark .text-gray-600 { color: #d1d5db; }
        .dark .text-gray-500 { color: #9ca3af; }
        .dark .text-gray-400 { color: #6b7280; }
        .dark .border-gray-200 { border-color: #4b5563; }
        .dark .bg-gray-200 { background-color: #4b5563; }
        .dark .bg-gray-100 { background-color: #374151; }
        .dark .hover\:bg-gray-50:hover { background-color: #374151; }
        .dark .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5); }
        .dark .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4); }

        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
            padding: 16px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success { background: linear-gradient(45deg, #10b981, #059669); }
        .notification.error { background: linear-gradient(45deg, #ef4444, #dc2626); }
        .notification.info { background: linear-gradient(45deg, #3b82f6, #2563eb); }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .profile-photo {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e5e7eb;
        }
        
        .profile-photo-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #e5e7eb;
        }

        .chat-bubble {
            max-width: 70%;
            word-wrap: break-word;
        }
        
        .chat-bubble.sent {
            background: linear-gradient(45deg, #667eea, #764ba2);
            margin-left: auto;
        }
        
        .chat-bubble.received {
            background: #f3f4f6;
            color: #374151;
        }
        
        .dark .chat-bubble.received {
            background: #4b5563;
            color: #e5e5e5;
        }

        .hover-scale:hover {
            transform: scale(1.05);
            transition: transform 0.2s ease;
        }

        .status-online {
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            border: 2px solid white;
            position: absolute;
            bottom: 0;
            right: 0;
        }

        .form-input {
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 flex flex-col items-center space-y-4 shadow-2xl">
            <div class="spinner"></div>
            <span class="text-gray-700 font-medium">Loading amazing content...</span>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="gradient-bg shadow-xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-white cursor-pointer hover-scale" onclick="showHome()">
                        üé® KalaKriti <span class="text-sm font-normal opacity-75">v5.0</span>
                    </h1>
                </div>
                
                <div id="navMenu" class="hidden flex items-center space-x-6">
                    <button onclick="showExplore()" class="text-white hover:text-gray-200 px-3 py-2 rounded-md transition-colors">
                        <i class="fas fa-compass mr-2"></i>Explore
                    </button>
                    
                    <button onclick="showMessages()" class="text-white hover:text-gray-200 px-3 py-2 rounded-md relative transition-colors">
                        <i class="fas fa-comments mr-2"></i>Messages
                        <span id="messageNotification" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center pulse-animation">0</span>
                    </button>
                    
                    <button onclick="showProfile()" class="text-white hover:text-gray-200 px-3 py-2 rounded-md transition-colors">
                        <i class="fas fa-user mr-2"></i>Profile
                    </button>
                    
                    <button onclick="toggleTheme()" class="text-white hover:text-gray-200 px-3 py-2 rounded-md transition-colors">
                        <i id="themeIcon" class="fas fa-moon"></i>
                    </button>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div id="authButtons" class="hidden flex items-center space-x-4">
                        <div class="flex items-center space-x-3">
                            <div id="userProfilePhoto" class="relative">
                                <!-- Profile photo will be inserted here -->
                            </div>
                            <span class="text-white font-medium">Welcome, <span id="userNameNav"></span>!</span>
                        </div>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                    <div id="guestButtons">
                        <button onclick="showLogin()" class="text-white hover:text-gray-200 px-3 py-2 rounded-md transition-colors">Login</button>
                        <button onclick="showRegister()" class="bg-white text-purple-600 hover:bg-gray-100 px-4 py-2 rounded-lg transition-colors">Sign Up</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Home Page -->
        <div id="homePage">
            <!-- Hero Section -->
            <div class="hero-bg rounded-2xl text-white p-12 mb-12 text-center fade-in">
                <h1 class="text-6xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-200">
                    Connect. Create. Collaborate.
                </h1>
                <p class="text-xl mb-8 opacity-90 max-w-2xl mx-auto">
                    Join KalaKriti v5.0 - The most advanced platform for creative collaboration with enhanced features and seamless user experience
                </p>
                <div id="heroButtons">
                    <button onclick="showRegister()" class="bg-white text-purple-600 hover:bg-gray-100 px-8 py-4 rounded-xl font-semibold mr-4 hover-scale transition-all">
                        üöÄ Get Started Free
                    </button>
                    <button onclick="showLogin()" class="border-2 border-white text-white hover:bg-white hover:text-purple-600 px-8 py-4 rounded-xl font-semibold hover-scale transition-all">
                        üîë Sign In
                    </button>
                </div>
                <div id="heroWelcome" class="hidden">
                    <p class="text-xl mb-6">Welcome back to your enhanced creative community!</p>
                    <button onclick="showExplore()" class="bg-white text-purple-600 hover:bg-gray-100 px-8 py-4 rounded-xl font-semibold mr-4 hover-scale transition-all">
                        üåç Explore Artists
                    </button>
                    <button onclick="showMessages()" class="border-2 border-white text-white hover:bg-white hover:text-purple-600 px-8 py-4 rounded-xl font-semibold hover-scale transition-all">
                        üí¨ Check Messages
                    </button>
                </div>
            </div>

            <!-- Features Section -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
                <div class="bg-white p-8 rounded-xl shadow-lg card-hover text-center fade-in">
                    <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-users text-2xl text-purple-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-4">Smart Matching</h3>
                    <p class="text-gray-600">AI-powered algorithm finds perfect collaborators based on your skills and interests</p>
                </div>
                <div class="bg-white p-8 rounded-xl shadow-lg card-hover text-center fade-in">
                    <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-palette text-2xl text-green-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-4">Portfolio Showcase</h3>
                    <p class="text-gray-600">Beautiful galleries to display your work with advanced filtering and categorization</p>
                </div>
                <div class="bg-white p-8 rounded-xl shadow-lg card-hover text-center fade-in">
                    <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-comments text-2xl text-blue-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-4">Real-time Chat</h3>
                    <p class="text-gray-600">Instant messaging with file sharing, voice notes, and project collaboration tools</p>
                </div>
                <div class="bg-white p-8 rounded-xl shadow-lg card-hover text-center fade-in">
                    <div class="bg-orange-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-rocket text-2xl text-orange-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-4">Project Management</h3>
                    <p class="text-gray-600">Built-in tools to manage collaborative projects from concept to completion</p>
                </div>
            </div>

            <!-- Live Activity Feed -->
            <div id="liveActivity" class="bg-white rounded-xl shadow-lg p-8 mb-12 fade-in">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üî• Live Activity</h2>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full pulse-animation"></div>
                        <span class="text-sm text-gray-600">Live Updates</span>
                    </div>
                </div>
                <div id="activityFeed" class="space-y-4">
                    <!-- Activity items will be populated here -->
                </div>
            </div>

            <!-- Featured Artists -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-12 fade-in">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‚≠ê Featured Artists</h2>
                <div id="featuredArtists" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Featured artists will be populated here -->
                </div>
            </div>

            <!-- Statistics -->
            <div class="bg-gradient-to-r from-purple-600 via-blue-600 to-teal-600 rounded-xl text-white p-8 text-center fade-in">
                <h2 class="text-3xl font-bold mb-8">üåü Join Our Thriving Community</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div class="hover-scale">
                        <div class="text-4xl font-bold mb-2" id="totalArtists">0</div>
                        <div class="text-purple-200">üë• Active Artists</div>
                    </div>
                    <div class="hover-scale">
                        <div class="text-4xl font-bold mb-2" id="totalWorks">0</div>
                        <div class="text-purple-200">üé® Creative Works</div>
                    </div>
                    <div class="hover-scale">
                        <div class="text-4xl font-bold mb-2" id="totalCollaborations">0</div>
                        <div class="text-purple-200">ü§ù Collaborations</div>
                    </div>
                    <div class="hover-scale">
                        <div class="text-4xl font-bold mb-2" id="totalMessages">0</div>
                        <div class="text-purple-200">üí¨ Messages Sent</div>
                    </div>
                </div>
            </div>
        </div>



        <!-- Explore Page -->
        <div id="explorePage" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üåç Explore Artists & Projects</h2>
                
                <!-- Category Filters -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4">Filter by Category</h3>
                    <div class="flex flex-wrap gap-3" id="categoryFilters">
                        <button onclick="filterByCategory('all')" class="category-filter active bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                            All Categories
                        </button>
                        <button onclick="filterByCategory('Music')" class="category-filter bg-gray-200 text-gray-700 hover:bg-purple-100 px-4 py-2 rounded-lg transition-colors">
                            üéµ Music
                        </button>
                        <button onclick="filterByCategory('Visual Arts')" class="category-filter bg-gray-200 text-gray-700 hover:bg-purple-100 px-4 py-2 rounded-lg transition-colors">
                            üé® Visual Arts
                        </button>
                        <button onclick="filterByCategory('Writing')" class="category-filter bg-gray-200 text-gray-700 hover:bg-purple-100 px-4 py-2 rounded-lg transition-colors">
                            ‚úçÔ∏è Writing
                        </button>
                        <button onclick="filterByCategory('Photography')" class="category-filter bg-gray-200 text-gray-700 hover:bg-purple-100 px-4 py-2 rounded-lg transition-colors">
                            üì∏ Photography
                        </button>
                        <button onclick="filterByCategory('Dance')" class="category-filter bg-gray-200 text-gray-700 hover:bg-purple-100 px-4 py-2 rounded-lg transition-colors">
                            üíÉ Dance
                        </button>
                    </div>
                </div>

                <div id="exploreContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Explore content will be populated here -->
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden fade-in">
            <!-- User Profile Section -->
            <div id="profileSection" class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üë§ My Profile</h2>
                    <div class="flex space-x-3">
                        <button onclick="showAddTalent()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add Talent
                        </button>
                        <button onclick="showEditProfile()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-edit mr-2"></i>Edit Profile
                        </button>
                    </div>
                </div>
                <div id="userProfile" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Profile content will be populated by JavaScript -->
                </div>
            </div>

            <!-- My Works Section -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üé® My Creative Works</h2>
                    <button onclick="showUploadWork()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-upload mr-2"></i>Upload New Work
                    </button>
                </div>
                <div id="myWorks" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Works will be populated by JavaScript -->
                </div>
            </div>

            <!-- Collaboration Feed -->
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">ü§ù Collaboration Opportunities</h2>
                <div id="collaborationFeed" class="space-y-6">
                    <!-- Feed will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Messages Section -->
        <div id="messagesSection" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üí¨ Messages</h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Chat List -->
                    <div class="lg:col-span-1">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">Conversations</h3>
                            <button onclick="refreshChats()" class="text-gray-500 hover:text-gray-700 p-2 rounded-lg transition-colors">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div id="chatList" class="space-y-2 max-h-96 overflow-y-auto">
                            <!-- Chat list will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Chat Window -->
                    <div class="lg:col-span-2">
                        <div id="chatWindow" class="border rounded-xl h-96 flex flex-col">
                            <div id="chatHeader" class="bg-gray-50 p-4 border-b rounded-t-xl">
                                <p class="text-gray-500">Select a conversation to start chatting</p>
                            </div>
                            <div id="chatMessages" class="flex-1 p-4 overflow-y-auto space-y-3">
                                <!-- Messages will appear here -->
                            </div>
                            <div id="chatInput" class="hidden border-t p-4">
                                <div class="flex space-x-2">
                                    <input type="text" id="messageInput" placeholder="Type your message..." 
                                           class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500 form-input"
                                           onkeypress="sendMessageOnEnter(event)">
                                    <button onclick="sendMessage()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg transition-colors">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Profile View -->
        <div id="userProfileView" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üë§ Artist Profile</h2>
                    <button onclick="showHome()" class="text-gray-500 hover:text-gray-700 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>Back
                    </button>
                </div>
                <div id="profileViewContent">
                    <!-- Profile content will be populated here -->
                </div>
            </div>
        </div>
    </div>


    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 fade-in">
            <h2 class="text-2xl font-bold mb-6 text-center">üîë Login to KalaKriti</h2>
            <form onsubmit="login(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üìß Email</label>
                    <input type="email" id="loginEmail" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üîí Password</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                </div>
                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    Login
                </button>
            </form>
            <button onclick="closeModal('loginModal')" class="mt-4 w-full text-gray-500 hover:text-gray-700 py-2 transition-colors">Cancel</button>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 fade-in">
            <h2 class="text-2xl font-bold mb-6 text-center">üöÄ Join KalaKriti v5.0</h2>
            <form onsubmit="register(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üë§ Full Name</label>
                    <input type="text" id="registerName" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üìß Email</label>
                    <input type="email" id="registerEmail" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                </div>
                <div class="mb-4">
                    <div class="space-y-3">
                        <div id="photoPreview" class="hidden text-center">
                            <img id="previewImage" class="w-20 h-20 rounded-full object-cover mx-auto border-2 border-gray-300">
                            <p class="text-sm text-gray-600 mt-2">Photo Preview</p>
                        </div>
                    </div>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üîí Password</label>
                    <input type="password" id="registerPassword" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                </div>
                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    Create Account
                </button>
            </form>
            <button onclick="closeModal('registerModal')" class="mt-4 w-full text-gray-500 hover:text-gray-700 py-2 transition-colors">Cancel</button>
        </div>
    </div>

    <!-- Add Talent Modal -->
    <div id="addTalentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 fade-in">
            <h2 class="text-2xl font-bold mb-6 text-center">üéØ Add Your Talent</h2>
            <form onsubmit="addTalent(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üé® Talent Category</label>
                    <select id="talentCategory" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                        <option value="">Select Category</option>
                        <option value="Music">üéµ Music</option>
                        <option value="Visual Arts">üé® Visual Arts</option>
                        <option value="Writing">‚úçÔ∏è Writing</option>
                        <option value="Dance">üíÉ Dance</option>
                        <option value="Photography">üì∏ Photography</option>
                        <option value="Video Production">üé¨ Video Production</option>
                        <option value="Voice Acting">üé§ Voice Acting</option>
                        <option value="Graphic Design">üñåÔ∏è Graphic Design</option>
                        <option value="Digital Art">üíª Digital Art</option>
                        <option value="Animation">üéûÔ∏è Animation</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">‚ö° Specific Skill</label>
                    <input type="text" id="talentSkill" placeholder="e.g., Singing, Guitar, Songwriting, Portrait Photography" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üìä Experience Level</label>
                    <select id="talentLevel" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                        <option value="">Select Level</option>
                        <option value="Beginner">üå± Beginner (0-1 years)</option>
                        <option value="Intermediate">üåø Intermediate (1-3 years)</option>
                        <option value="Advanced">üå≥ Advanced (3-5 years)</option>
                        <option value="Professional">üèÜ Professional (5+ years)</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    Add Talent
                </button>
            </form>
            <button onclick="closeModal('addTalentModal')" class="mt-4 w-full text-gray-500 hover:text-gray-700 py-2 transition-colors">Cancel</button>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 fade-in">
            <h2 class="text-2xl font-bold mb-6 text-center">‚úèÔ∏è Edit Profile</h2>
            <form onsubmit="updateProfile(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üë§ Full Name</label>
                    <input type="text" id="editName" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üìß Email</label>
                    <input type="email" id="editEmail" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üì∏ Profile Photo</label>
                    <div class="space-y-3">
                        <input type="file" id="editPhotoFile" accept="image/*" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" onchange="handleEditPhotoUpload(event)">
                        <div class="text-center text-gray-500 text-sm">OR</div>
                        <input type="url" id="editPhoto" placeholder="https://example.com/your-photo.jpg" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" placeholder="Enter photo URL">
                        <div id="editPhotoPreview" class="hidden text-center">
                            <img id="editPreviewImage" class="w-20 h-20 rounded-full object-cover mx-auto border-2 border-gray-300">
                            <p class="text-sm text-gray-600 mt-2">Photo Preview</p>
                        </div>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üé® Primary Art Category</label>
                    <select id="editCategory" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                        <option value="">Select Your Main Category</option>
                        <option value="Music">üéµ Music</option>
                        <option value="Visual Arts">üé® Visual Arts</option>
                        <option value="Writing">‚úçÔ∏è Writing</option>
                        <option value="Dance">üíÉ Dance</option>
                        <option value="Photography">üì∏ Photography</option>
                        <option value="Video Production">üé¨ Video Production</option>
                        <option value="Voice Acting">üé§ Voice Acting</option>
                        <option value="Graphic Design">üñåÔ∏è Graphic Design</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üîí New Password (leave blank to keep current)</label>
                    <input type="password" id="editPassword" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input">
                </div>
                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    Update Profile
                </button>
            </form>
            <button onclick="closeModal('editProfileModal')" class="mt-4 w-full text-gray-500 hover:text-gray-700 py-2 transition-colors">Cancel</button>
        </div>
    </div>

    <!-- Upload Work Modal -->
    <div id="uploadWorkModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 fade-in">
            <h2 class="text-2xl font-bold mb-6 text-center">üé® Upload Your Work</h2>
            <form onsubmit="uploadWork(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üìù Work Title</label>
                    <input type="text" id="workTitle" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üéØ Category</label>
                    <select id="workCategory" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                        <option value="">Select Category</option>
                        <option value="Music">üéµ Music</option>
                        <option value="Visual Arts">üé® Visual Arts</option>
                        <option value="Writing">‚úçÔ∏è Writing</option>
                        <option value="Dance">üíÉ Dance</option>
                        <option value="Photography">üì∏ Photography</option>
                        <option value="Video Production">üé¨ Video Production</option>
                        <option value="Digital Art">üíª Digital Art</option>
                        <option value="Animation">üéûÔ∏è Animation</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üìÑ Description</label>
                    <textarea id="workDescription" rows="3" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üîó Work URL (Optional)</label>
                    <input type="url" id="workUrl" placeholder="https://example.com/your-work" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">ü§ù Looking for Collaboration?</label>
                    <select id="workCollaboration" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input">
                        <option value="No">üìã No, just showcasing</option>
                        <option value="Yes">ü§ù Yes, seeking collaborators</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    Upload Work
                </button>
            </form>
            <button onclick="closeModal('uploadWorkModal')" class="mt-4 w-full text-gray-500 hover:text-gray-700 py-2 transition-colors">Cancel</button>
        </div>
    </div>

    <!-- Edit Work Modal -->
    <div id="editWorkModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 fade-in">
            <h2 class="text-2xl font-bold mb-6 text-center">‚úèÔ∏è Edit Work</h2>
            <form id="editWorkForm">
                <input type="hidden" id="editWorkId">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üìù Work Title</label>
                    <input type="text" id="editWorkTitle" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üéØ Category</label>
                    <input type="text" id="editWorkCategory" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üìÑ Description</label>
                    <textarea id="editWorkDescription" rows="3" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input" required></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">üîó Work URL (Optional)</label>
                    <input type="url" id="editWorkUrl" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">ü§ù Looking for Collaboration?</label>
                    <select id="editWorkCollaboration" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-purple-500 form-input">
                        <option value="No">üìã No, just showcasing</option>
                        <option value="Yes">ü§ù Yes, seeking collaborators</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">Update Work</button>
            </form>
            <button onclick="closeModal('editWorkModal')" class="mt-4 w-full text-gray-500 hover:text-gray-700 py-2 transition-colors">Cancel</button>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentChatUser = null;
        let currentFilter = 'all';
        let isDarkMode = false;
        
        // Load user session from localStorage on page load
        function loadUserSession() {
            const savedUser = localStorage.getItem('kalakriti_user');
            const savedTheme = localStorage.getItem('kalakriti_theme');
            
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    console.log('User session restored:', currentUser.name);
                } catch (error) {
                    console.error('Failed to restore user session:', error);
                    localStorage.removeItem('kalakriti_user');
                }
            }
            
            if (savedTheme) {
                isDarkMode = savedTheme === 'dark';
                document.body.classList.toggle('dark', isDarkMode);
            }
        }
        
        // Save user session to localStorage
        function saveUserSession() {
            if (currentUser) {
                localStorage.setItem('kalakriti_user', JSON.stringify(currentUser));
            } else {
                localStorage.removeItem('kalakriti_user');
            }
        }
        
        // Save theme preference
        function saveThemePreference() {
            localStorage.setItem('kalakriti_theme', isDarkMode ? 'dark' : 'light');
        }

        // Sample data
        let users = [];

        let works = [];

        let messages = [];

        // Photo upload handler
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoPreview = document.getElementById('photoPreview');
                    const previewImage = document.getElementById('previewImage');
                    previewImage.src = e.target.result;
                    photoPreview.classList.remove('hidden');
                    
                    // Clear URL input when file is selected
                    document.getElementById('registerPhoto').value = '';
                };
                reader.readAsDataURL(file);
            }
        }

        // Utility functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function hideAllSections() {
            const sections = ['homePage', 'dashboard', 'messagesSection', 'userProfileView', 'explorePage'];
            sections.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
        }

        function updateAuthUI() {
            if (currentUser) {
                document.getElementById('authButtons').classList.remove('hidden');
                document.getElementById('guestButtons').classList.add('hidden');
                document.getElementById('navMenu').classList.remove('hidden');
                document.getElementById('userNameNav').textContent = currentUser.name;
                document.getElementById('heroButtons').classList.add('hidden');
                document.getElementById('heroWelcome').classList.remove('hidden');
                
                const profilePhotoDiv = document.getElementById('userProfilePhoto');
                if (currentUser.photo) {
                    profilePhotoDiv.innerHTML = `
                        <img src="${currentUser.photo}" alt="${currentUser.name}" 
                             class="profile-photo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="profile-photo bg-purple-100 flex items-center justify-center" style="display:none;">
                            <i class="fas fa-user text-purple-600"></i>
                        </div>
                    `;
                } else {
                    profilePhotoDiv.innerHTML = `
                        <div class="profile-photo bg-purple-100 flex items-center justify-center">
                            <i class="fas fa-user text-purple-600"></i>
                        </div>
                    `;
                }
            } else {
                document.getElementById('authButtons').classList.add('hidden');
                document.getElementById('navMenu').classList.add('hidden');
                document.getElementById('guestButtons').classList.remove('hidden');
                document.getElementById('heroButtons').classList.remove('hidden');
                document.getElementById('heroWelcome').classList.add('hidden');
            }
        }

        // Navigation functions
        async function showHome() {
            hideAllSections();
            document.getElementById('homePage').classList.remove('hidden');
            
            showLoading();
            try {
                await Promise.all([
                    updateHomeStats(),
                    updateFeaturedArtists(),
                    updateLiveActivity()
                ]);
            } catch (error) {
                showNotification('Failed to load home page data', 'error');
            } finally {
                hideLoading();
            }
        }

        async function showExplore() {
            if (!currentUser) {
                showLogin();
                return;
            }

            hideAllSections();
            document.getElementById('explorePage').classList.remove('hidden');
            
            showLoading();
            try {
                await updateExploreContent();
            } catch (error) {
                showNotification('Failed to load explore page', 'error');
            } finally {
                hideLoading();
            }
        }

        async function showProfile() {
            if (!currentUser) {
                showLogin();
                return;
            }

            hideAllSections();
            document.getElementById('dashboard').classList.remove('hidden');
            
            showLoading();
            try {
                await Promise.all([
                    updateProfile(),
                    updateMyWorks(),
                    updateCollaborationFeed(),
                    updateHomeStats()
                ]);
            } catch (error) {
                showNotification('Failed to load profile data', 'error');
            } finally {
                hideLoading();
            }
        }

        async function showMessages() {
            if (!currentUser) {
                showLogin();
                return;
            }

            hideAllSections();
            document.getElementById('messagesSection').classList.remove('hidden');
            
            try {
                await updateChatList();
            } catch (error) {
                showNotification('Failed to load messages', 'error');
            }
        }

        // Authentication functions
        function showLogin() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function showRegister() {
            document.getElementById('registerModal').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        async function login(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            showLoading();
            try {
                const user = users.find(u => u.email === email && u.password === password);
                if (user) {
                    currentUser = user;
                    saveUserSession(); // Save session to localStorage
                    closeModal('loginModal');
                    updateAuthUI();
                    showNotification(`Welcome back, ${user.name}! üéâ`, 'success');
                    await showHome();
                    
                    document.getElementById('loginEmail').value = '';
                    document.getElementById('loginPassword').value = '';
                } else {
                    showNotification('Invalid email or password', 'error');
                }
            } catch (error) {
                showNotification('Login failed. Please try again.', 'error');
            } finally {
                hideLoading();
            }
        }

        async function register(event) {
            event.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const photoUrl = document.getElementById('registerPhoto').value;
            const photoFile = document.getElementById('registerPhotoFile').files[0];
            const category = document.getElementById('registerCategory').value;
            const password = document.getElementById('registerPassword').value;
            
            let photo = photoUrl;
            if (photoFile) {
                // Convert file to base64 for storage
                const reader = new FileReader();
                photo = await new Promise((resolve) => {
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(photoFile);
                });
            }

            showLoading();
            try {
                if (users.find(u => u.email === email)) {
                    showNotification('Email already exists!', 'error');
                    return;
                }

                const newUser = {
                    id: Date.now(),
                    name,
                    email,
                    photo: photo || null,
                    primaryCategory: category,
                    password,
                    talents: [],
                    joinDate: new Date().toISOString(),
                    isOnline: true
                };

                users.push(newUser);
                currentUser = newUser;
                saveUserSession(); // Save session to localStorage
                closeModal('registerModal');
                updateAuthUI();
                showNotification(`Welcome to KalaKriti v5.0, ${name}! üöÄ`, 'success');
                await showProfile();
                
                document.getElementById('registerName').value = '';
                document.getElementById('registerEmail').value = '';
                document.getElementById('registerPhoto').value = '';
                document.getElementById('registerPhotoFile').value = '';
                document.getElementById('registerCategory').value = '';
                document.getElementById('registerPassword').value = '';
                document.getElementById('photoPreview').classList.add('hidden');
            } catch (error) {
                showNotification('Registration failed. Please try again.', 'error');
            } finally {
                hideLoading();
            }
        }

        function logout() {
            currentUser = null;
            currentChatUser = null;
            saveUserSession(); // Clear session from localStorage
            updateAuthUI();
            showHome();
            showNotification('Logged out successfully! See you soon! üëã', 'success');
        }

        // Data update functions
        async function updateHomeStats() {
            try {
                // Calculate dynamic stats
                const totalArtists = users.length;
                const totalWorks = works.length;
                const totalCollaborations = works.filter(w => w.collaboration === 'Yes').length;
                const totalMessages = messages.length;
                
                // Update display with animation
                animateNumber('totalArtists', totalArtists);
                animateNumber('totalWorks', totalWorks);
                animateNumber('totalCollaborations', totalCollaborations);
                animateNumber('totalMessages', totalMessages);
                
                // Update user-specific stats if logged in
                if (currentUser) {
                    const userWorks = works.filter(w => w.userId === currentUser.id);
                    const userCollaborations = userWorks.filter(w => w.collaboration === 'Yes').length;
                    const userMessages = messages.filter(m => m.senderId === currentUser.id || m.receiverId === currentUser.id);
                    
                    // Update user stats in profile section
                    const userStatsElements = document.querySelectorAll('.user-stats');
                    userStatsElements.forEach(element => {
                        if (element.id === 'userWorksCount') {
                            animateNumber('userWorksCount', userWorks.length);
                        } else if (element.id === 'userCollaborationsCount') {
                            animateNumber('userCollaborationsCount', userCollaborations);
                        } else if (element.id === 'userMessagesCount') {
                            animateNumber('userMessagesCount', userMessages.length);
                        }
                    });
                }
            } catch (error) {
                console.error('Failed to update stats:', error);
            }
        }
        
        // Animate number changes
        function animateNumber(elementId, targetValue) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const currentValue = parseInt(element.textContent) || 0;
            const increment = (targetValue - currentValue) / 20;
            let current = currentValue;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= targetValue) || (increment < 0 && current <= targetValue)) {
                    element.textContent = targetValue;
                    clearInterval(timer);
                } else {
                    element.textContent = Math.floor(current);
                }
            }, 50);
        }

        async function updateLiveActivity() {
            try {
                const activities = [];
                
                users.filter(u => {
                    const joinDate = new Date(u.joinDate);
                    const daysSinceJoin = (Date.now() - joinDate.getTime()) / (1000 * 60 * 60 * 24);
                    return daysSinceJoin <= 7;
                }).forEach(user => {
                    activities.push({
                        type: 'user_joined',
                        user: user.name,
                        timestamp: user.joinDate,
                        message: `${user.name} joined as a ${user.primaryCategory} artist`
                    });
                });
                
                works.filter(w => {
                    const workDate = new Date(w.createdAt);
                    const daysSinceWork = (Date.now() - workDate.getTime()) / (1000 * 60 * 60 * 24);
                    return daysSinceWork <= 3;
                }).forEach(work => {
                    activities.push({
                        type: 'work_uploaded',
                        user: work.userName,
                        timestamp: work.createdAt,
                        message: `${work.userName} uploaded "${work.title}" ${work.collaboration === 'Yes' ? '(seeking collaboration)' : ''}`
                    });
                });
                
                const sortedActivities = activities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0, 5);
                const activityDiv = document.getElementById('activityFeed');
                
                if (sortedActivities.length === 0) {
                    activityDiv.innerHTML = `
                        <div class="text-center py-8">
                            <div class="text-4xl mb-3">üöÄ</div>
                            <p class="text-gray-500 mb-2">No recent activity yet!</p>
                            <p class="text-gray-400 text-sm">Join our community and be the first to create something amazing.</p>
                        </div>
                    `;
                    return;
                }

                activityDiv.innerHTML = sortedActivities.map(activity => `
                    <div class="flex items-start space-x-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <div class="bg-${activity.type === 'user_joined' ? 'green' : 'blue'}-100 w-10 h-10 rounded-full flex items-center justify-center">
                            <i class="fas fa-${activity.type === 'user_joined' ? 'user-plus' : 'upload'} text-${activity.type === 'user_joined' ? 'green' : 'blue'}-600"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-gray-800">${activity.message}</p>
                            <p class="text-sm text-gray-500">${new Date(activity.timestamp).toLocaleString()}</p>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to update live activity:', error);
            }
        }

        async function updateFeaturedArtists() {
            try {
                const featuredUsers = users
                    .filter(u => currentUser ? u.id !== currentUser.id : true)
                    .sort((a, b) => (b.talents?.length || 0) - (a.talents?.length || 0))
                    .slice(0, 3);
                
                const featuredDiv = document.getElementById('featuredArtists');
                
                if (featuredUsers.length === 0) {
                    featuredDiv.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="text-6xl mb-4">üé®</div>
                            <p class="text-gray-500 mb-4">No artists to showcase yet!</p>
                            <p class="text-gray-400 text-sm">Be the first to join our creative community and start collaborating.</p>
                        </div>
                    `;
                    return;
                }
                
                featuredDiv.innerHTML = featuredUsers.map(user => `
                    <div class="bg-gray-50 p-6 rounded-xl card-hover">
                        <div class="flex items-center mb-4">
                            ${user.photo ? 
                                `<img src="${user.photo}" alt="${user.name}" class="profile-photo-large mr-4" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                 <div class="profile-photo-large bg-purple-100 flex items-center justify-center mr-4" style="display:none;">
                                    <i class="fas fa-user text-purple-600 text-2xl"></i>
                                 </div>` :
                                `<div class="profile-photo-large bg-purple-100 flex items-center justify-center mr-4">
                                    <i class="fas fa-user text-purple-600 text-2xl"></i>
                                 </div>`
                            }
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <h3 class="font-semibold text-gray-800">${user.name}</h3>
                                    ${user.isOnline ? '<div class="status-online"></div>' : ''}
                                </div>
                                <p class="text-sm text-gray-600">${user.primaryCategory} Artist</p>
                                <p class="text-xs text-gray-500">Joined ${new Date(user.joinDate || Date.now()).toLocaleDateString()}</p>
                            </div>
                        </div>
                        <div class="mb-4">
                            <p class="text-sm font-medium text-gray-700 mb-2">üéØ Specializes in:</p>
                            <div class="flex flex-wrap gap-1">
                                ${user.talents && user.talents.length > 0 ? user.talents.slice(0, 3).map(talent => 
                                    `<span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs">${talent.skill}</span>`
                                ).join('') : '<span class="text-gray-500 text-xs">No talents listed yet</span>'}
                            </div>
                        </div>
                        ${currentUser ? `
                            <div class="flex space-x-2">
                                <button onclick="viewArtistProfile(${user.id})" 
                                        class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                    üë§ View Profile
                                </button>
                                <button onclick="startChat(${user.id}, '${user.name}')" 
                                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                    üí¨
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to update featured artists:', error);
            }
        }

        async function updateExploreContent() {
            try {
                let filteredUsers = users.filter(u => 
                    currentUser ? u.id !== currentUser.id : true
                );
                
                if (currentFilter !== 'all') {
                    filteredUsers = filteredUsers.filter(u => 
                        u.primaryCategory === currentFilter ||
                        (u.talents && u.talents.some(t => t.category === currentFilter))
                    );
                }
                
                const exploreDiv = document.getElementById('exploreContent');
                
                if (filteredUsers.length === 0) {
                    exploreDiv.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">No artists found in this category.</p>';
                    return;
                }

                exploreDiv.innerHTML = filteredUsers.map(user => {
                    const userWorks = works.filter(w => w.userId === user.id);
                    return `
                        <div class="bg-white border rounded-xl p-6 card-hover">
                            <div class="flex items-center mb-4">
                                ${user.photo ? 
                                    `<img src="${user.photo}" alt="${user.name}" class="profile-photo mr-3" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                     <div class="profile-photo bg-purple-100 flex items-center justify-center mr-3" style="display:none;">
                                        <i class="fas fa-user text-purple-600"></i>
                                     </div>` :
                                    `<div class="profile-photo bg-purple-100 flex items-center justify-center mr-3">
                                        <i class="fas fa-user text-purple-600"></i>
                                     </div>`
                                }
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2">
                                        <h3 class="font-semibold text-gray-800">${user.name}</h3>
                                        ${user.isOnline ? '<div class="w-2 h-2 bg-green-500 rounded-full"></div>' : ''}
                                    </div>
                                    <p class="text-sm text-gray-600">${user.primaryCategory}</p>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <div class="flex flex-wrap gap-1 mb-2">
                                    ${(user.talents || []).slice(0, 3).map(talent => 
                                        `<span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs">${talent.skill}</span>`
                                    ).join('')}
                                </div>
                                <p class="text-xs text-gray-500">
                                    ${userWorks.length} works ‚Ä¢ ${userWorks.filter(w => w.collaboration === 'Yes').length} seeking collaboration
                                </p>
                            </div>
                            
                            <div class="flex space-x-2">
                                <button onclick="viewArtistProfile(${user.id})" 
                                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                    üë§ Profile
                                </button>
                                <button onclick="startChat(${user.id}, '${user.name}')" 
                                        class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                    üí¨ Chat
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Failed to update explore content:', error);
            }
        }

        function filterByCategory(category) {
            currentFilter = category;
            
            document.querySelectorAll('.category-filter').forEach(btn => {
                btn.classList.remove('active', 'bg-purple-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('active', 'bg-purple-600', 'text-white');
            
            updateExploreContent();
        }

        async function updateProfile() {
            if (!currentUser) {
                // If not logged in, show login modal and return
                showLogin();
                return;
            }

            try {
                const userWorks = works.filter(w => w.userId === currentUser.id);
                const userTalents = currentUser.talents || [];
                const userStats = {
                    uploads: userWorks.length,
                    collaborations: userWorks.filter(w => w.collaboration === 'Yes').length,
                    messages: messages.filter(m => m.senderId === currentUser.id || m.receiverId === currentUser.id).length,
                    daysActive: Math.floor((Date.now() - new Date(currentUser.joinDate).getTime()) / (1000 * 60 * 60 * 24))
                };

                const userActivities = [];
                userWorks.forEach(work => {
                    userActivities.push({
                        type: 'work_uploaded',
                        timestamp: work.createdAt,
                        message: `Uploaded "${work.title}" ${work.collaboration === 'Yes' ? '(seeking collaboration)' : ''}`
                    });
                    if (work.updatedAt && work.updatedAt !== work.createdAt) {
                        userActivities.push({
                            type: 'work_edited',
                            timestamp: work.updatedAt,
                            message: `Edited "${work.title}"`
                        });
                    }
                });
                userTalents.forEach(talent => {
                    userActivities.push({
                        type: 'talent_added',
                        timestamp: talent.addedAt || currentUser.joinDate,
                        message: `Added talent: ${talent.skill} (${talent.category})`
                    });
                });
                userActivities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                const profileDiv = document.getElementById('userProfile');
                profileDiv.innerHTML = `
                    <div>
                        <div class="flex items-center mb-6">
                            ${currentUser.photo ? 
                                `<img src="${currentUser.photo}" alt="${currentUser.name}" class="profile-photo-large mr-4" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                 <div class="profile-photo-large bg-purple-100 flex items-center justify-center mr-4" style="display:none;">
                                    <i class="fas fa-user text-2xl text-purple-600"></i>
                                 </div>` :
                                `<div class="profile-photo-large bg-purple-100 flex items-center justify-center mr-4">
                                    <i class="fas fa-user text-2xl text-purple-600"></i>
                                 </div>`
                            }
                            <div>
                                <h3 class="text-2xl font-semibold text-gray-800 mb-2">üëã ${currentUser.name}</h3>
                                <p class="text-gray-600">üìß ${currentUser.email}</p>
                                <p class="text-sm text-gray-500">üé® ${currentUser.primaryCategory} Artist</p>
                                <p class="text-sm text-gray-500">üìÖ Joined ${new Date(currentUser.joinDate).toLocaleDateString()}</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-xl p-4 mb-6 flex items-center justify-around shadow">
                            <div class="flex flex-col items-center">
                                <div class="text-2xl font-bold">${userWorks.length}</div>
                                <div class="text-sm">Works</div>
                            </div>
                            <div class="w-px h-8 bg-white opacity-30 mx-6"></div>
                            <div class="flex flex-col items-center">
                                <div class="text-2xl font-bold">${userTalents.length}</div>
                                <div class="text-sm">Skills</div>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-xl mb-6 shadow flex items-center overflow-x-auto space-x-4" style="min-height:70px;">
                            <i class="fas fa-bolt text-yellow-500 text-xl"></i>
                            <div class="flex-1 flex space-x-6">
                                ${userActivities.length === 0 ?
                                    '<span class="text-gray-400">No recent activity yet.</span>' :
                                    userActivities.slice(0, 5).map(activity => `
                                        <div class="flex flex-col items-center min-w-[120px]">
                                            <div class="text-xs text-gray-500 mb-1">${new Date(activity.timestamp).toLocaleDateString()}</div>
                                            <div class="text-sm text-gray-800">${activity.message}</div>
                                        </div>
                                    `).join('')
                                }
                            </div>
                        </div>
                        <div class="bg-purple-50 p-6 rounded-xl mb-6">
                            <h4 class="font-semibold text-purple-800 mb-4">üéØ Your Talents</h4>
                            ${userTalents.length > 0 ?
                                '<div class="grid grid-cols-1 gap-3">' +
                                userTalents.map(talent =>
                                    `<div class="flex items-center justify-between bg-white p-3 rounded-lg">
                                        <div>
                                            <span class="font-medium text-gray-800">${talent.skill}</span>
                                            <span class="text-sm text-gray-600 ml-2">(${talent.category})</span>
                                        </div>
                                        <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-sm">${talent.level}</span>
                                    </div>`
                                ).join('') + '</div>' : 
                                '<p class="text-gray-500">No talents added yet. Click "Add Talent" to get started!</p>'
                            }
                        </div>
                        <div class="bg-blue-50 p-6 rounded-xl mb-6">
                            <h4 class="font-semibold text-blue-800 mb-4">üìä Your Stats</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-600 user-stats" id="userWorksCount">${userStats.uploads}</div>
                                    <div class="text-sm text-blue-700">üé® Works</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-600 user-stats" id="userCollaborationsCount">${userStats.collaborations}</div>
                                    <div class="text-sm text-blue-700">ü§ù Collaborations</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-600 user-stats" id="userMessagesCount">${userStats.messages}</div>
                                    <div class="text-sm text-blue-700">üí¨ Messages</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-600">${userStats.daysActive}</div>
                                    <div class="text-sm text-blue-700">üìÖ Days Active</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Failed to update profile:', error);
            }
        }

        async function updateMyWorks() {
            if (!currentUser) return;

            try {
                const userWorks = works.filter(w => w.userId === currentUser.id);
                const myWorksDiv = document.getElementById('myWorks');
                
                if (userWorks.length === 0) {
                    myWorksDiv.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="text-6xl mb-4">üé®</div>
                            <p class="text-gray-500 mb-4">No works uploaded yet</p>
                            <button onclick="showUploadWork()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors">
                                Upload Your First Work
                            </button>
                        </div>
                    `;
                    return;
                }

                myWorksDiv.innerHTML = userWorks.map(work => `
                    <div class="bg-gray-50 p-6 rounded-xl card-hover">
                        <div class="flex items-start justify-between mb-4">
                            <h4 class="font-semibold text-gray-800 text-lg cursor-pointer" onclick="incrementWorkView(${work.id})">${work.title}</h4>
                            <div class="flex space-x-2">
                                ${work.url ? `<a href="${work.url}" target="_blank" class="text-blue-600 hover:text-blue-700" onclick="incrementWorkView(${work.id})"><i class="fas fa-external-link-alt"></i></a>` : ''}
                                <button onclick="editWork(${work.id})" class="text-gray-600 hover:text-gray-700"><i class="fas fa-edit"></i></button>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 mb-3">
                            <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm">${work.category}</span>
                            ${work.collaboration === 'Yes' ? 
                                '<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">ü§ù Open for Collaboration</span>' : 
                                '<span class="bg-gray-200 text-gray-700 px-3 py-1 rounded-full text-sm">üìã Showcase</span>'
                            }
                        </div>
                        <p class="text-gray-600 text-sm mb-4">${work.description}</p>
                        <div class="flex items-center justify-between text-xs text-gray-400">
                            <span>üìÖ ${new Date(work.createdAt || work.date).toLocaleDateString()}</span>
                            <span>üëÅÔ∏è ${work.views || 0} views</span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to update my works:', error);
            }
        }

        async function updateCollaborationFeed() {
            if (!currentUser) return;

            try {
                const collaborationWorks = works.filter(w => 
                    w.collaboration === 'Yes' && w.userId !== currentUser.id
                ).sort((a, b) => new Date(b.createdAt || b.date) - new Date(a.createdAt || a.date));
                
                const feedDiv = document.getElementById('collaborationFeed');
                
                if (collaborationWorks.length === 0) {
                    feedDiv.innerHTML = `
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">ü§ù</div>
                            <p class="text-gray-500 mb-4">No collaboration opportunities available right now</p>
                            <button onclick="showExplore()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors">
                                Explore Artists
                            </button>
                        </div>
                    `;
                    return;
                }

                feedDiv.innerHTML = collaborationWorks.map(work => {
                    const author = users.find(u => u.id === work.userId);
                    return `
                        <div class="border border-gray-200 rounded-xl p-6 card-hover bg-white">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    ${author?.photo ? 
                                        `<img src="${author.photo}" alt="${work.userName}" class="profile-photo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                         <div class="profile-photo bg-purple-100 flex items-center justify-center" style="display:none;">
                                            <i class="fas fa-user text-purple-600"></i>
                                         </div>` :
                                        `<div class="profile-photo bg-purple-100 flex items-center justify-center">
                                            <i class="fas fa-user text-purple-600"></i>
                                         </div>`
                                    }
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-800">${work.title}</h3>
                                        <p class="text-sm text-gray-600">by ${work.userName}</p>
                                    </div>
                                </div>
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">ü§ù Seeking Collaboration</span>
                            </div>
                            
                            <div class="mb-4">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-sm">${work.category}</span>
                                    <span class="text-xs text-gray-400">üìÖ ${new Date(work.createdAt || work.date).toLocaleDateString()}</span>
                                </div>
                            </div>
                            
                            <p class="text-gray-700 mb-4">${work.description}</p>
                            
                            ${author && author.talents && author.talents.length > 0 ? `
                                <div class="mb-4">
                                    <p class="text-sm font-medium text-gray-700 mb-2">üéØ Artist's Skills:</p>
                                    <div class="flex flex-wrap gap-1">
                                        ${author.talents.slice(0, 4).map(talent => 
                                            `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">${talent.skill}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="flex space-x-3">
                                <button onclick="viewArtistProfile(${work.userId})" 
                                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                    üë§ View Profile
                                </button>
                                <button onclick="startChat(${work.userId}, '${work.userName}')" 
                                        class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                    üí¨ Start Chat
                                </button>
                                ${work.url ? `
                                    <a href="${work.url}" target="_blank" 
                                       class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                        üîó View Work
                                    </a>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Failed to update collaboration feed:', error);
            }
        }

        // Form handlers
        function showAddTalent() {
            document.getElementById('addTalentModal').classList.remove('hidden');
        }

        function showUploadWork() {
            document.getElementById('uploadWorkModal').classList.remove('hidden');
        }

        function showEditProfile() {
            if (!currentUser) return;
            
            // Populate form with current user data
            document.getElementById('editName').value = currentUser.name;
            document.getElementById('editEmail').value = currentUser.email;
            document.getElementById('editPhoto').value = currentUser.photo || '';
            document.getElementById('editCategory').value = currentUser.primaryCategory;
            document.getElementById('editPassword').value = '';
            
            // Show current photo preview
            const previewDiv = document.getElementById('editPhotoPreview');
            const previewImg = document.getElementById('editPreviewImage');
            if (currentUser.photo) {
                previewImg.src = currentUser.photo;
                previewDiv.classList.remove('hidden');
            } else {
                previewDiv.classList.add('hidden');
            }
            
            document.getElementById('editProfileModal').classList.remove('hidden');
        }
        
        function handleEditPhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('editPhoto').value = e.target.result;
                    document.getElementById('editPreviewImage').src = e.target.result;
                    document.getElementById('editPhotoPreview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }
        
        async function updateProfile(event) {
            event.preventDefault();
            if (!currentUser) return;
            
            const name = document.getElementById('editName').value;
            const email = document.getElementById('editEmail').value;
            const photo = document.getElementById('editPhoto').value;
            const category = document.getElementById('editCategory').value;
            const password = document.getElementById('editPassword').value;
            
            showLoading();
            try {
                // Check if email is already taken by another user
                const existingUser = users.find(u => u.email === email && u.id !== currentUser.id);
                if (existingUser) {
                    showNotification('Email already exists!', 'error');
                    return;
                }
                
                // Update user data
                currentUser.name = name;
                currentUser.email = email;
                currentUser.photo = photo || null;
                currentUser.primaryCategory = category;
                
                if (password) {
                    currentUser.password = password;
                }
                
                // Update in users array
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                }
                
                // Save updated session
                saveUserSession();
                
                closeModal('editProfileModal');
                updateAuthUI();
                await updateUserProfile();
                showNotification('Profile updated successfully! ‚ú®', 'success');
                
                // Clear form
                document.getElementById('editName').value = '';
                document.getElementById('editEmail').value = '';
                document.getElementById('editPhoto').value = '';
                document.getElementById('editCategory').value = '';
                document.getElementById('editPassword').value = '';
                document.getElementById('editPhotoPreview').classList.add('hidden');
                
            } catch (error) {
                showNotification('Failed to update profile. Please try again.', 'error');
            } finally {
                hideLoading();
            }
        }

        async function addTalent(event) {
            event.preventDefault();
            if (!currentUser) return;

            const category = document.getElementById('talentCategory').value;
            const skill = document.getElementById('talentSkill').value;
            const level = document.getElementById('talentLevel').value;

            showLoading();
            try {
                const talentData = { category, skill, level };
                
                currentUser.talents = currentUser.talents || [];
                currentUser.talents.push(talentData);
                saveUserSession();

                closeModal('addTalentModal');
                showNotification(`Added ${skill} to your talents! üéØ`, 'success');
                await Promise.all([
                    updateUserProfile(),
                    updateHomeStats()
                ]);
                
                document.getElementById('talentCategory').value = '';
                document.getElementById('talentSkill').value = '';
                document.getElementById('talentLevel').value = '';
            } catch (error) {
                showNotification('Failed to add talent', 'error');
            } finally {
                hideLoading();
            }
        }

        async function uploadWork(event) {
            event.preventDefault();
            if (!currentUser) return;

            const title = document.getElementById('workTitle').value;
            const category = document.getElementById('workCategory').value;
            const description = document.getElementById('workDescription').value;
            const url = document.getElementById('workUrl').value;
            const collaboration = document.getElementById('workCollaboration').value;

            showLoading();
            try {
                const workData = {
                    id: Date.now(),
                    userId: currentUser.id,
                    userName: currentUser.name,
                    title,
                    category,
                    description,
                    url: url || null,
                    collaboration,
                    createdAt: new Date().toISOString()
                };

                works.push(workData);

                closeModal('uploadWorkModal');
                showNotification(`"${title}" uploaded successfully! üé®`, 'success');
                await Promise.all([
                    updateMyWorks(),
                    updateCollaborationFeed(),
                    updateHomeStats()
                ]);
                
                document.getElementById('workTitle').value = '';
                document.getElementById('workCategory').value = '';
                document.getElementById('workDescription').value = '';
                document.getElementById('workUrl').value = '';
                document.getElementById('workCollaboration').value = 'No';
            } catch (error) {
                showNotification('Failed to upload work', 'error');
            } finally {
                hideLoading();
            }
        }



        // Profile viewing
        async function viewArtistProfile(userId) {
            if (!currentUser) {
                showLogin();
                return;
            }

            showLoading();
            try {
                const artist = users.find(u => u.id === userId);
                if (!artist) {
                    showNotification('Artist not found', 'error');
                    return;
                }

                hideAllSections();
                document.getElementById('userProfileView').classList.remove('hidden');

                const artistWorks = works.filter(w => w.userId === userId);
                
                document.getElementById('profileViewContent').innerHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-1">
                            <div class="bg-gray-50 p-6 rounded-xl">
                                <div class="text-center mb-6">
                                    ${artist.photo ? 
                                        `<img src="${artist.photo}" alt="${artist.name}" class="w-24 h-24 rounded-full object-cover mx-auto mb-4" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                         <div class="w-24 h-24 rounded-full bg-purple-100 flex items-center justify-center mx-auto mb-4" style="display:none;">
                                            <i class="fas fa-user text-3xl text-purple-600"></i>
                                         </div>` :
                                        `<div class="w-24 h-24 rounded-full bg-purple-100 flex items-center justify-center mx-auto mb-4">
                                            <i class="fas fa-user text-3xl text-purple-600"></i>
                                         </div>`
                                    }
                                    <div class="flex items-center justify-center space-x-2 mb-2">
                                        <h3 class="text-2xl font-bold text-gray-800">${artist.name}</h3>
                                        ${artist.isOnline ? '<div class="w-3 h-3 bg-green-500 rounded-full"></div>' : '<div class="w-3 h-3 bg-gray-400 rounded-full"></div>'}
                                    </div>
                                    <p class="text-gray-600 mb-2">üìß ${artist.email}</p>
                                    <p class="text-sm text-gray-500">üé® ${artist.primaryCategory} Artist</p>
                                    <p class="text-sm text-gray-500">üìÖ Joined ${new Date(artist.joinDate).toLocaleDateString()}</p>
                                </div>
                                
                                <div class="space-y-4">
                                    <button onclick="startChat(${artist.id}, '${artist.name}')" 
                                            class="w-full bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors">
                                        üí¨ Start Conversation
                                    </button>
                                    <button onclick="showHome()" 
                                            class="w-full bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors">
                                        üè† Back to Home
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2 space-y-6">
                            <div class="bg-purple-50 p-6 rounded-xl">
                                <h4 class="font-semibold text-purple-800 mb-4">üéØ Talents & Skills</h4>
                                ${(artist.talents || []).length > 0 ? 
                                    '<div class="grid grid-cols-1 md:grid-cols-2 gap-3">' +
                                    artist.talents.map(talent => `
                                        <div class="bg-white p-4 rounded-lg">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <span class="font-medium text-gray-800">${talent.skill}</span>
                                                    <p class="text-sm text-gray-600">${talent.category}</p>
                                                </div>
                                                <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-sm">${talent.level}</span>
                                            </div>
                                        </div>
                                    `).join('') + '</div>' :
                                    '<p class="text-gray-500">No talents listed yet.</p>'
                                }
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl border">
                                <h4 class="text-xl font-semibold text-gray-800 mb-4">üé® Recent Works (${artistWorks.length})</h4>
                                ${artistWorks.length > 0 ? 
                                    '<div class="space-y-4">' +
                                    artistWorks.slice(0, 4).map(work => `
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <div class="flex items-start justify-between mb-2">
                                                <h5 class="font-semibold text-gray-800">${work.title}</h5>
                                                ${work.url ? `<a href="${work.url}" target="_blank" class="text-blue-600 hover:text-blue-700"><i class="fas fa-external-link-alt"></i></a>` : ''}
                                            </div>
                                            <div class="flex items-center space-x-2 mb-2">
                                                <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-sm">${work.category}</span>
                                                ${work.collaboration === 'Yes' ? 
                                                    '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">ü§ù Open for Collaboration</span>' : ''
                                                }
                                            </div>
                                            <p class="text-gray-600 text-sm mb-2">${work.description}</p>
                                            <p class="text-xs text-gray-400">üìÖ ${new Date(work.createdAt || work.date).toLocaleDateString()}</p>
                                        </div>
                                    `).join('') + '</div>' :
                                    '<p class="text-gray-500 text-center py-8">No works uploaded yet.</p>'
                                }
                            </div>
                            
                            <div class="bg-blue-50 p-6 rounded-xl">
                                <h4 class="font-semibold text-blue-800 mb-4">üìä Artist Stats</h4>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-blue-600">${artistWorks.length}</div>
                                        <div class="text-sm text-blue-700">üé® Works</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-blue-600">${artistWorks.filter(w => w.collaboration === 'Yes').length}</div>
                                        <div class="text-sm text-blue-700">ü§ù Collaborations</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-blue-600">${(artist.talents || []).length}</div>
                                        <div class="text-sm text-blue-700">üéØ Talents</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-blue-600">${Math.floor((Date.now() - new Date(artist.joinDate).getTime()) / (1000 * 60 * 60 * 24))}</div>
                                        <div class="text-sm text-blue-700">üìÖ Days Active</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                showNotification('Failed to load artist profile', 'error');
            } finally {
                hideLoading();
            }
        }

        // Chat functionality
        async function startChat(userId, userName) {
            if (!currentUser) {
                showLogin();
                return;
            }

            currentChatUser = userId;
            
            await showMessages();
            
            const user = users.find(u => u.id === userId);
            document.getElementById('chatHeader').innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        ${user?.photo ? 
                            `<img src="${user.photo}" alt="${userName}" class="profile-photo mr-3" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                             <div class="profile-photo bg-purple-100 flex items-center justify-center mr-3" style="display:none;">
                                <i class="fas fa-user text-purple-600"></i>
                             </div>` :
                            `<div class="profile-photo bg-purple-100 flex items-center justify-center mr-3">
                                <i class="fas fa-user text-purple-600"></i>
                             </div>`
                        }
                        <div>
                            <h4 class="font-semibold text-gray-800">${userName}</h4>
                            <p class="text-sm text-gray-500">${user?.isOnline ? 'üü¢ Online' : '‚ö´ Offline'}</p>
                        </div>
                    </div>
                    <button onclick="viewArtistProfile(${userId})" class="text-gray-500 hover:text-gray-700 px-3 py-1 rounded-lg transition-colors">
                        üë§ View Profile
                    </button>
                </div>
            `;
            
            document.getElementById('chatInput').classList.remove('hidden');
            await loadChatMessages(userId);
        }

        async function updateChatList() {
            if (!currentUser) return;

            try {
                const conversations = new Map();
                messages.forEach(msg => {
                    const otherUserId = msg.senderId === currentUser.id ? msg.receiverId : msg.senderId;
                    const otherUser = users.find(u => u.id === otherUserId);
                    
                    if (otherUser && (msg.senderId === currentUser.id || msg.receiverId === currentUser.id)) {
                        if (!conversations.has(otherUserId) || new Date(msg.createdAt || msg.timestamp) > new Date(conversations.get(otherUserId).timestamp)) {
                            conversations.set(otherUserId, {
                                user: otherUser,
                                lastMessage: msg.content,
                                timestamp: msg.createdAt || msg.timestamp,
                                unread: msg.receiverId === currentUser.id && !msg.read
                            });
                        }
                    }
                });

                const chatListDiv = document.getElementById('chatList');
                
                if (conversations.size === 0) {
                    chatListDiv.innerHTML = `
                        <div class="text-center py-8">
                            <div class="text-4xl mb-2">üí¨</div>
                            <p class="text-gray-500 text-sm">No conversations yet</p>
                            <button onclick="showExplore()" class="mt-3 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                Find Artists to Chat
                            </button>
                        </div>
                    `;
                    return;
                }

                chatListDiv.innerHTML = Array.from(conversations.values())
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .map(conv => `
                        <div onclick="startChat(${conv.user.id}, '${conv.user.name}')" 
                             class="p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors ${currentChatUser === conv.user.id ? 'bg-purple-50 border-purple-200' : ''}">
                            <div class="flex items-center space-x-3">
                                ${conv.user.photo ? 
                                    `<img src="${conv.user.photo}" alt="${conv.user.name}" class="w-10 h-10 rounded-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                     <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center" style="display:none;">
                                        <i class="fas fa-user text-purple-600"></i>
                                     </div>` :
                                    `<div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center">
                                        <i class="fas fa-user text-purple-600"></i>
                                     </div>`
                                }
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between">
                                        <h4 class="font-medium text-gray-800 truncate">${conv.user.name}</h4>
                                        ${conv.unread ? '<div class="w-2 h-2 bg-purple-500 rounded-full"></div>' : ''}
                                    </div>
                                    <p class="text-sm text-gray-600 truncate">${conv.lastMessage}</p>
                                    <p class="text-xs text-gray-400">${new Date(conv.timestamp).toLocaleDateString()}</p>
                                </div>
                            </div>
                        </div>
                    `).join('');
            } catch (error) {
                console.error('Failed to update chat list:', error);
            }
        }

        async function loadChatMessages(userId) {
            if (!currentUser) return;

            try {
                const chatMessages = messages.filter(msg => 
                    (msg.senderId === currentUser.id && msg.receiverId === userId) ||
                    (msg.senderId === userId && msg.receiverId === currentUser.id)
                ).sort((a, b) => new Date(a.createdAt || a.timestamp) - new Date(b.createdAt || b.timestamp));

                const messagesDiv = document.getElementById('chatMessages');
                
                if (chatMessages.length === 0) {
                    messagesDiv.innerHTML = `
                        <div class="text-center py-8">
                            <div class="text-4xl mb-2">üëã</div>
                            <p class="text-gray-500">Start your conversation!</p>
                        </div>
                    `;
                    return;
                }

                messagesDiv.innerHTML = chatMessages.map(msg => `
                    <div class="flex ${msg.senderId === currentUser.id ? 'justify-end' : 'justify-start'}">
                        <div class="chat-bubble ${msg.senderId === currentUser.id ? 'sent text-white' : 'received'} px-4 py-2 rounded-lg">
                            <p>${msg.content}</p>
                            <p class="text-xs opacity-75 mt-1">${new Date(msg.createdAt || msg.timestamp).toLocaleTimeString()}</p>
                        </div>
                    </div>
                `).join('');

                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            } catch (error) {
                console.error('Failed to load chat messages:', error);
            }
        }

        function sendMessageOnEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            if (!currentUser || !currentChatUser) return;

            const messageInput = document.getElementById('messageInput');
            const content = messageInput.value.trim();
            
            if (!content) return;

            try {
                const newMessage = {
                    id: Date.now(),
                    senderId: currentUser.id,
                    receiverId: currentChatUser,
                    content: content,
                    createdAt: new Date().toISOString(),
                    read: false
                };

                messages.push(newMessage);
                messageInput.value = '';
                
                await Promise.all([
                    loadChatMessages(currentChatUser),
                    updateChatList(),
                    updateHomeStats()
                ]);
            } catch (error) {
                showNotification('Failed to send message', 'error');
            }
        }

        function refreshChats() {
            updateChatList();
            showNotification('Chats refreshed! üîÑ', 'success');
        }

        // Theme toggle
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark', isDarkMode);
            document.getElementById('themeIcon').className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
            saveThemePreference(); // Save theme preference
            showNotification(`Switched to ${isDarkMode ? 'dark' : 'light'} theme! üé®`, 'success');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadUserSession(); // Load saved session
            updateAuthUI();
            showHome();
        });

        // 1. Add views property to works and increment on view
        async function incrementWorkView(workId) {
            const work = works.find(w => w.id === workId);
            if (work) {
                work.views = (work.views || 0) + 1;
                // Optionally, persist to backend/localStorage here
                updateMyWorks();
                updateCollaborationFeed();
            }
        }

        // 2. Edit work logic
        function editWork(workId) {
            const work = works.find(w => w.id === workId);
            if (!work) return;
            document.getElementById('editWorkId').value = work.id;
            document.getElementById('editWorkTitle').value = work.title;
            document.getElementById('editWorkCategory').value = work.category;
            document.getElementById('editWorkDescription').value = work.description;
            document.getElementById('editWorkUrl').value = work.url || '';
            document.getElementById('editWorkCollaboration').value = work.collaboration;
            document.getElementById('editWorkModal').classList.remove('hidden');
        }

        document.getElementById('editWorkForm').onsubmit = async function(event) {
            event.preventDefault();
            const workId = Number(document.getElementById('editWorkId').value);
            const work = works.find(w => w.id === workId);
            if (!work) return;
            work.title = document.getElementById('editWorkTitle').value;
            work.category = document.getElementById('editWorkCategory').value;
            work.description = document.getElementById('editWorkDescription').value;
            work.url = document.getElementById('editWorkUrl').value;
            work.collaboration = document.getElementById('editWorkCollaboration').value;
            // Optionally, persist to backend/localStorage here
            closeModal('editWorkModal');
            await updateMyWorks();
            await updateCollaborationFeed();
            await updateHomeStats();
            showNotification('Work updated successfully!', 'success');
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'963309ee215bb2be',t:'MTc1MzE4ODM2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
